# Домашнее задание к занятию «Микросервисы: подходы»

## Задача 1: Обеспечить разработку

Для обеспечения разработки подойдет GitLab - комплексное решение, позволяющее как хранить код в git, так и организовывать CI/CD процессы.

Такое решение будет соответствовать всем требованиям:
- облачная система - GitLab может быть развернут как в облаке, так и на собственной инфраструктуре;
- система контроля версий Git - основная функция GitLab, встроенный сервер git;
- репозиторий на каждый сервис - GitLab поддерживает неограниченное количество репозиториев, как public, так и private;
- запуск сборки по событию из системы контроля версий - GitLab CI/CD pipelines можно запускать с помощью различных триггеров, в том числе по изменению кода в git;
- запуск сборки по кнопке с указанием параметров - GitLab CI/CD pipelines можно запускать вручную с указанием переменных;
- возможность привязать настройки к каждой сборке - GitLab CI/CD variables - разновидность переменных окружения, их можно задавать не только для каждой сборки, 
но и для всего репозитория, группы репозиториев и даже всего инстанса GitLab, переменные можно использовать как на стороне GitLab, так и на стороне агентов 
сборки (GitLab Runner);
- возможность создания шаблонов для различных конфигураций сборок - имеется в виде job templates, обладают свойствами обобщенности (не содержат конкретных данных),
импортируемости (можно использовать во множестве конфигураций) и настраиваемости (за счет использования переменных);
- возможность безопасного хранения секретных данных (пароли, ключи доступа) - GitLab позволяет хранить секретные данные как внутри, так и во внешних сервисах, 
например HashiCorp Vault;
- несколько конфигураций для сборки из одного репозитория - поддерживается, можно указать произвольный конфигурационный файл при запуске pipeline;
- кастомные шаги при сборке - GitLab позволяет задавать и произвольно настраивать шаги (stages) в pipeline;
- собственные докер-образы для сборки проектов - GitLab Container Registry позволяет хранить собственные образы и собирать их них проекты;
- возможность развернуть агентов сборки на собственных серверах - GitLab Runner - приложение, которое можно установить на собственные серверы 
и которое будет запускать сборку проекта в соответствии с CI/CD pipeline;
- возможность параллельного запуска нескольких сборок - поддерживается;
- возможность параллельного запуска тестов - поддерживается.

## Задача 2: Логи

Для сбора логов предлагаю использовать [OpenSearch](https://opensearch.org/) (более свободный и доступный аналог ELK стека)

Проект OpenSearch управляется сообществом и лицензируется под Apache 2.0.
Как и ELK, OpenSearch содержит в себе index-based хранилище данных с возможностями поиска на основе библиотеки Apache Lucene,
компонент OpenSearch Dashboards для визуализации запросов к хранилищу, а также DataPrepper - компонент сбора данных с возможностью 
фильтрации, преобразования, нормализации и агрегирования данных

Таким образом, все условия задачи выполняются:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему - через DataPrepper собираются данные (логи) и отправляются в 
центральное хранилище OpenSearch, можно также использовать более традиционный Logstash;
- минимальные требования к приложениям, сбор логов из stdout - OpenSearch поддерживает те же агенты (beats), что и ELK стек, они легковесны и могут 
быть настроены на чтение stdout приложений через стандартные pipeline ОС;
- гарантированная доставка логов до центрального хранилища - агенты (beats) гарантируют доставку как минимум единожды без потери данных, это достигается
путем использования реестра, в котором хранятся статусы событий, которые передает агент;
- обеспечение поиска и фильтрации по записям логов - за это отвечает компонент OpenSearch Dashboards, его функционал в целом повторяет функционал Kibana;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов - за это также отвечает компонент
 OpenSearch Dashboards;
- возможность дать ссылку на сохранённый поиск по записям логов - как и Kibana, OpenSearch Dashboards позволяет сохранять запросы и экспортировать 
их в различные форматы (plain text, JSON, CSV)

## Задача 3: Мониторинг

Для мониторинга подойдет стандартная связка Prometheus/Grafana.

Работает она следующим образом:
- Экспортеры собирают данные с хостов и возвращают их в виде набора метрик. 
- Prometheus получает метрики от экспортеров и сохраняет их в БД временных рядов
- Grafana отвечает за визуализацию и анализ информации

Связка Prometheus/Grafana обеспечивает:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию - за это отвечает Grafana;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы - Grafana позволяет 
создавать dashboards с произвольным набором отображаемых данных.
