# Домашнее задание к занятию "6.1. Типы и структура СУБД"
## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

- Электронные чеки в json виде - документо-ориентированная СУБД (напр. mongoDB), типичная
задача хранения документов, не имеющих прямых связей друг с другом.
- Склады и автомобильные дороги для логистической компании -
здесь скорее всего важно быстро находить оптимальные маршруты для перемещения грузов с/на
и между складами. Лучшим выбором тогда будет аналитическая column-oriented СУБД
(напр. ClickHouse), предназначенная для выполнения OLAP запросов.
- Генеалогические деревья - сетевая СУБД (напр. InterSystems Cache). Генеалогическое дерево -
это жестко заданная структура, состоящая из объектов (родителей и потомков) и постоянных
связей между ними, причем у одного родителя может быть несколько потомков (или вовсе не быть),
а у потомка - несколько родителей, как минимум 2, но и больше, если нужно хранить 
информацию, например, об усыновлении. Эту структуру как раз и реализуют сетевые СУБД.
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации - 
здесь выбираем key-value СУБД (Redis, Memcached). Идентификаторы представляют собой как раз
структуру key-value, длительное хранение не требуется (можно задать TTL), 
а вот скорость работы важна.
- Отношения клиент-покупка для интернет-магазина - здесь в зависимости от того, что
именно и для чего хранится: просто список клиентов и их покупок лучше хранить в
классической реляционной СУБД (основном хранилище данных интернет-магазина), т.к. эти
данные хранятся длительное время и не изменяются (уже совершенные покупки); для анализа
предпочтений клиентов лучше подойдет аналитическая колоночная СУБД, как в случае с 
логистической компанией; список просмотренных товаров - в key-value СУБД (Redis), 
т.к. эти данные не нужно долго хранить, а предоставить нужно быстро.

  
## Задача 2
Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

- Данные записываются на все узлы с задержкой до часа (асинхронная запись) - PA по CAP, 
страдает согласованность; PC/EL по PACELC, система стремится оставаться согласованной при
разделении (поэтому данные все же синхронизируют, хоть и с задержкой до часа), 
а при отсутствии разделения делает ставку на низкие задержки (latency), 
здесь согласованность уже не так важна.
- При сетевых сбоях, система может разделиться на 2 раздельных кластера - CA по CAP,
страдает устойчивость к разделению; PA/EL по PACELC, здесь важнее всего доступность и низкие 
задержки при ответе, про стремление сохранять согласованность ничего не сказано, 
но раз система может в любой момент разделиться, то видимо она не очень важна.
- Система может не прислать корректный ответ или сбросить соединение - PC по CAP,
страдает доступность; PC/EC по PACELC, согласованность важнее доступности и низких задержек.

## Задача 3
Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?</br> 

ACID принципы относятся к реляционным СУБД, по главу которых поставлена высокая надежность.
Принципы BASE появились позднее ACID и им следуют NoSQL системы, в которых сознательно 
пожертвовали принципами ACID в угоду большей доступности и производительности.
С этой точки зрения ACID и BASE не сочетаются, или одно, или другое, но
не оба сразу. Я не нашел популярной системы, в которой бы заявлялось сочетание обоих 
принципов, однако попытка создать такую систему была описана в статье 
(https://www.usenix.org/system/files/conference/osdi14/osdi14-paper-xie.pdf). В ней описано
создание СУБД Salt на основе модифицированной MySQL. В этой системе предпринята попытка
улучшить производительность ACID систем путем постепенного внедрения BASE подходов и 
приблизить их к производительности BASE систем.
Авторы Salt мотивировались принципом Парето, в соответствии с которым количество
транзакций, действительно сильно влияющих на общую производительность ACID СУБД,
на самом деле невелико. В Salt вводится понятие BASE-транзакции - абстракции, управляющей
процессом проведения критичных для производительности транзакций. BASE-транзакции
сохраняют такие принципы ACID, как атомарность и стойкость, но благодаря механизму
Salt Isolation можно гибко управлять изоляцией транзакций, добиваясь увеличения 
производительности. По утверждению авторов, им удалось добиться 6-ти кратного увеличения
производительности по сравнению с "чистой" MySQL.</br> 
Так что, отвечая на вопрос, одно можно сказать точно - попытки сочетать ACID и BASE
в рамках одной системы предпринимаются.


## Задача 4
Вам дали задачу написать системное решение, основой которого бы послужили:
- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута
Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

Судя по описанию, речь идет о Redis - одной из самых популярных key-value СУБД
с поддержкой pub/sub.
У Redis, как pub/sub платформы, имеются следующие недостатки:
- сообщения публикуются по принципу fire-and-forget, это означает, что при отсутствии
подписчиков в канале сообщения будут удаляться без возможности восстановления
- клиент, который подключился к каналу в качестве подписчика, переходит в read-only режим
и не может отправлять команды
- высокая производительность достигается лишь при небольшом количестве клиентов, а также
зависит от размера сообщения
- нужно выбирать между высокой пропускной способностью (throughput) и низкой задержкой 
(latency)
- клиент должен уметь сам переподключаться в случае обрыва соединения